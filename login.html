<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALIKO JB | Login</title>

<style>
/* RESET */
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,sans-serif;}
body{min-height:100vh;background:#020617;display:flex;justify-content:center;align-items:center;color:#e5e7eb;}
.app{width:100%;max-width:380px;padding:28px 22px 32px;background:#0f172a;border-radius:26px;box-shadow:0 30px 70px rgba(0,0,0,.65);}
.app h1{font-size:22px;text-align:center;margin-bottom:8px;}
.app p{text-align:center;font-size:14px;color:#94a3b8;margin-bottom:18px;}
.tabs{display:flex;background:#020617;border-radius:999px;padding:6px;margin-bottom:20px;}
.tabs button{flex:1;padding:10px 0;background:transparent;border:none;border-radius:999px;color:#94a3b8;font-weight:600;font-size:15px;}
.tabs .active{background:#38bdf8;color:#020617;}
.form{display:none;}
.form.active{display:block;}
input{width:100%;padding:15px;margin-top:14px;border:none;border-radius:18px;background:#020617;color:#e5e7eb;font-size:15px;}
input:focus{outline:2px solid #38bdf8;}
.main-btn{width:100%;padding:15px;margin-top:18px;background:linear-gradient(135deg,#38bdf8,#0ea5e9);border:none;border-radius:20px;font-weight:800;font-size:16px;color:#020617;}
.msg{margin-top:10px;font-size:14px;text-align:center;color:#f87171;}
.success{color:#22c55e;}
</style>

</head>
<body>

<div class="app">

  <h1>ALIKO JB Academy</h1>
  <p>Automotive Engineering Learning Platform</p>

  <div class="tabs">
    <button id="loginTab" class="active" onclick="showLogin()">Login</button>
    <button id="regTab" onclick="showRegister()">Register</button>
  </div>

  <!-- LOGIN FORM -->
  <form id="loginForm" class="form active" onsubmit="loginUser(); return false;">
    <input id="login-email" type="email" placeholder="Email" required/>
    <input id="login-password" type="password" placeholder="Password" required/>
    <button class="main-btn" type="submit">Login</button>
    <p id="loginMsg" class="msg"></p>
  </form>

  <!-- REGISTER FORM -->
<form id="regForm" class="form" onsubmit="registerUser(); return false;">
  <input id="reg-username" placeholder="Full Name" required />
  <input id="reg-email" type="email" placeholder="Email" required />
  <input id="reg-password" type="password" placeholder="Password" required />
  <button class="main-btn" type="submit">Register</button>
  <p id="regMsg" class="msg"></p>
  </form>

<!-- FIREBASE -->
<script type="module" src="firebase/firebase.js"></script>

<script type="module">
import { auth, db } from "../firebase/firebase.js";
import {
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ==========================
   FORM SWITCHING
========================== */
window.showLogin = () => {
  document.getElementById("loginForm").classList.add("active");
  document.getElementById("regForm").classList.remove("active");
  document.getElementById("loginTab").classList.add("active");
  document.getElementById("regTab").classList.remove("active");
};

window.showRegister = () => {
  document.getElementById("regForm").classList.add("active");
  document.getElementById("loginForm").classList.remove("active");
  document.getElementById("regTab").classList.add("active");
  document.getElementById("loginTab").classList.remove("active");
};

/* ==========================
   REGISTER USER
========================== */
window.registerUser = async () => {
  const name = document.getElementById("reg-username").value.trim();
  const email = document.getElementById("reg-email").value.trim();
  const password = document.getElementById("reg-password").value.trim();
  const regMsg = document.getElementById("regMsg");

  if(!name || !email || !password){
    regMsg.textContent = "Fill all fields";
    return;
  }

  try{
    const cred = await createUserWithEmailAndPassword(auth, email, password);

    await setDoc(doc(db,"users", cred.user.uid), {
      name,
      email,
      role: "student",
      createdAt: serverTimestamp()
    });

    regMsg.textContent = "Account created successfully!";
    regMsg.className = "msg success";

    setTimeout(()=>{window.location.href="academy.html"},1200);
  } catch(e){
    regMsg.textContent = e.message;
  }
};

/* ==========================
   LOGIN USER
========================== */
window.loginUser = async () => {
  const email = document.getElementById("login-email").value.trim();
  const password = document.getElementById("login-password").value.trim();
  const loginMsg = document.getElementById("loginMsg");

  try{
    const cred = await signInWithEmailAndPassword(auth,email,password);
    const snap = await getDoc(doc(db,"users",cred.user.uid));
    const role = snap.data().role;

    if(role==="admin"){
      window.location.href="admin.html";
    } else {
      window.location.href="academy.html";
    }

  } catch(e){
    loginMsg.textContent = "Invalid email or password";
  }
};

/* ==========================
   LOGOUT USER
========================== */
window.logout = async () => {
  await signOut(auth);
  window.location.href="login.html";
};

/* ==========================
   AUTO CHECK USER
========================== */
onAuthStateChanged(auth,(user)=>{
  if(user && (location.pathname.includes("login") || location.pathname.includes("register"))){
    window.location.href="academy.html";
  }
});
</script>
</body>
  </html>
