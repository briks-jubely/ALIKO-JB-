<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALIKO JB | Login</title>

<style>
/* RESET */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
}

/* BODY */
body{
  min-height:100vh;
  background:#020617;
  display:flex;
  justify-content:center;
  align-items:center;
  color:#e5e7eb;
}

/* CARD */
.app{
  width:100%;
  max-width:380px;
  padding:28px 22px 32px;
  background:#0f172a;
  border-radius:26px;
  box-shadow:0 30px 70px rgba(0,0,0,.65);
}

/* HEADER */
.app h1{
  font-size:22px;
  text-align:center;
  margin-bottom:8px;
}
.app p{
  text-align:center;
  font-size:14px;
  color:#94a3b8;
  margin-bottom:18px;
}

/* TABS */
.tabs{
  display:flex;
  background:#020617;
  border-radius:999px;
  padding:6px;
  margin-bottom:20px;
}
.tabs button{
  flex:1;
  padding:10px 0;
  background:transparent;
  border:none;
  border-radius:999px;
  color:#94a3b8;
  font-weight:600;
  font-size:15px;
}
.tabs .active{
  background:#38bdf8;
  color:#020617;
}

/* FORMS */
.form{display:none;}
.form.active{display:block;}

/* INPUTS */
input{
  width:100%;
  padding:15px;
  margin-top:14px;
  border:none;
  border-radius:18px;
  background:#020617;
  color:#e5e7eb;
  font-size:15px;
}
input:focus{
  outline:2px solid #38bdf8;
}

/* BUTTON */
.main-btn{
  width:100%;
  padding:15px;
  margin-top:18px;
  background:linear-gradient(135deg,#38bdf8,#0ea5e9);
  border:none;
  border-radius:20px;
  font-weight:800;
  font-size:16px;
  color:#020617;
}

/* MESSAGE */
.msg{
  margin-top:10px;
  font-size:14px;
  text-align:center;
  color:#f87171;
}
.success{color:#22c55e;}
</style>

</head>
<body>
  <script>
(function detectUser(){
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const loggedUser = localStorage.getItem("loggedInUser");

  // Kama yuko tayari logged in ‚Üí Academy
  if(loggedUser){
    if(location.pathname.includes("login")){
      window.location.href = "academy.html";
    }
    return;
  }

  // Kama hakuna users kabisa ‚Üí Register mode
  if(users.length === 0){
    localStorage.setItem("authMode", "register");
    return;
  }

  // Kama kuna users ‚Üí Login mode
  localStorage.setItem("authMode", "login");
})();
  </script>
<script>
/* üîç AUTO CHECK USER STATUS */
(function () {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const logged = localStorage.getItem("loggedInUser");

  if (logged) {
    window.location.href = "academy.html";
    return;
  }

  // kama hakuna user yeyote bado ‚Üí force register
  if (users.length === 0) {
    setTimeout(showRegister, 100);
  }
})();
</script>
<div class="app">

  <h1>ALIKO JB Academy</h1>
  <p>Automotive Engineering Learning Platform</p>

  <div class="tabs">
    <button id="loginTab" class="active" onclick="showLogin()">Login</button>
    <button id="regTab" onclick="showRegister()">Register</button>
  </div>

  <!-- LOGIN -->
  <div id="loginForm" class="form active">
    <input id="login-username" placeholder="Username">
    <input id="login-password" type="password" placeholder="Password">
    <button type="button" class="main-btn" onclick="loginUser()">Login</button>
    <div class="msg" id="loginMsg"></div>
  </div>

  <!-- REGISTER -->
  <div id="regForm" class="form">
    <input id="reg-username" placeholder="Username">
    <input id="reg-password" type="password" placeholder="Password">
    <button type="button" class="main-btn" onclick="registerUser()">Create Account</button>
    <div class="msg" id="regMsg"></div>
  </div>

</div>
  <script>
/* INIT */
if(!localStorage.getItem("users")){
  localStorage.setItem("users", JSON.stringify([]));
}

/* CHANGE FORMS */
function showLogin(){
  document.getElementById("loginForm").classList.add("active");
  document.getElementById("regForm").classList.remove("active");
  document.getElementById("loginTab").classList.add("active");
  document.getElementById("regTab").classList.remove("active");
}

function showRegister(){
  document.getElementById("regForm").classList.add("active");
  document.getElementById("loginForm").classList.remove("active");
  document.getElementById("regTab").classList.add("active");
  document.getElementById("loginTab").classList.remove("active");
}

/* REGISTER */
function registerUser() {
  const username = document.getElementById("reg-username").value.trim();
  const password = document.getElementById("reg-password").value.trim();
  const regMsg = document.getElementById("regMsg");

  if (!username || !password) {
    regMsg.textContent = "Tafadhali jaza taarifa zote";
    return;
  }

  let users = JSON.parse(localStorage.getItem("users")) || [];

  if (users.find(u => u.username === username)) {
    regMsg.textContent = "Username tayari ipo";
    return;
  }

  // 1Ô∏è‚É£ SAVE LOCAL
  users.push({ username, password });
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("loggedInUser", username);

  // 2Ô∏è‚É£ SEND TO GOOGLE FORM
  const date = new Date().toISOString().split("T")[0];

  const formURL =
    "https://docs.google.com/forms/d/e/1FAIpQLSd1Mf0E2vsNc71WlEFzxM6DZqoAsDCOtGlLCREq8wmHgYV2iA/formResponse";

  const formData = new FormData();
  formData.append("entry.1670782907", username);
  formData.append("entry.1731044643", password);
  formData.append("entry.1411221685", date);

  fetch(formURL, {
    method: "POST",
    mode: "no-cors",
    body: formData
  });

  // 3Ô∏è‚É£ SUCCESS MESSAGE (MODERN)
  regMsg.textContent = "Account created successfully ‚úì";
  regMsg.className = "msg success";

  setTimeout(() => {
    window.location.href = "academy.html";
  }, 1200);
}
  //loginUser 
function loginUser() {
  const username = document.getElementById("login-username").value.trim();
  const password = document.getElementById("login-password").value.trim();
  const loginMsg = document.getElementById("loginMsg");

  const users = JSON.parse(localStorage.getItem("users")) || [];

  const found = users.find(
    u => u.username === username && u.password === password
  );

  if (!found) {
    loginMsg.textContent = "Username au password sio sahihi";
    return;
  }

  localStorage.setItem("loggedInUser", username);

  // USER COUNT
  const totalUsers = users.length;

  // WHATSAPP UPDATE
  const msg =
    `ALIKO JB ACADEMY UPDATE%0A` +
    `User mpya ame-login%0A` +
    `Username: ${username}%0A` +
    `Jumla ya users: ${totalUsers}`;

  window.open(
    `https://wa.me/255750198672?text=${msg}`,
    "_blank"
  );

  window.location.href = "academy.html";
}
  </script>
</body>
  </html>
